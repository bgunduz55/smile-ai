(()=>{"use strict";const e=acquireVsCodeApi(),t=document.getElementById("messageInput"),n=document.getElementById("sendButton"),c=document.getElementById("messages"),o=document.getElementById("addModel"),a=document.getElementById("includeImports"),s=document.getElementById("includeTips"),d=document.getElementById("includeTests"),i=document.getElementById("message-template"),l=document.getElementById("code-block-template"),r=document.getElementById("file-attachment-template"),m=document.getElementById("attachFile"),p=document.getElementById("attachFolder"),u=document.getElementById("chatMode"),h=document.getElementById("openChat"),g=document.getElementById("openComposer"),v=document.querySelectorAll(".toolbar-button[data-view]");t&&n&&c||console.error("Essential DOM elements not found"),t?.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())})),n?.addEventListener("click",y),o?.addEventListener("click",(()=>{e.postMessage({command:"addModel"})})),h?.addEventListener("click",(()=>{e.postMessage({command:"openChat"})})),g?.addEventListener("click",(()=>{e.postMessage({command:"openComposer"})})),v.forEach((t=>{t.addEventListener("click",(()=>{const n=t.dataset.view;n&&(v.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),e.postMessage({command:"switchView",view:n}))}))})),t?.addEventListener("input",(()=>{t.style.height="auto",t.style.height=`${t.scrollHeight}px`}));let E=[];function y(){const n=t?.value.trim();if(n){const c={includeImports:a?.checked??!0,includeTips:s?.checked??!0,includeTests:d?.checked??!0,chatMode:u?.value??"chat"};e.postMessage({command:"sendMessage",text:n,options:c,attachments:E}),t&&(t.value="",t.style.height="auto"),E=[],f()}}function f(){const e=document.querySelector(".current-attachments");e&&(e.innerHTML="",E.forEach((t=>{const n=document.createElement("div");n.className="attachment-item",n.innerHTML=`\n            <i class="codicon codicon-${"file"===t.type?"file-code":"folder"}"></i>\n            <span>${t.path.split("/").pop()||t.path.split("\\").pop()}</span>\n            <button class="remove-attachment" data-path="${t.path}">\n                <i class="codicon codicon-close"></i>\n            </button>\n        `;const c=n.querySelector(".remove-attachment");c?.addEventListener("click",(()=>{const e=c.dataset.path;e&&(E=E.filter((t=>t.path!==e)),f())})),e.appendChild(n)})))}m?.addEventListener("click",(()=>{e.postMessage({command:"attachFile"})})),p?.addEventListener("click",(()=>{e.postMessage({command:"attachFolder"})})),window.addEventListener("message",(e=>{const t=e.data;switch(t.command){case"addMessage":t.message&&function(e){if(!i||!c)return;const t=i.content.cloneNode(!0),n=t.querySelector(".message"),o=t.querySelector(".avatar i"),a=t.querySelector(".markdown-content");if(!n||!o||!a)return;n.classList.add(e.role),o.classList.add("user"===e.role?"codicon-account":"codicon-hubot");const s=function(e){return e.replace(/```(\w*)\n([\s\S]*?)```/g,((e,t,n)=>{if(!l)return`<pre><code>${n}</code></pre>`;const c=l.content.cloneNode(!0),o=c.querySelector("code");o&&(t&&o.classList.add(`language-${t}`),o.textContent=n.trim());const a=document.createElement("div");return a.appendChild(c),a.innerHTML})).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")}(e.content);if(a.innerHTML=s,e.attachments&&e.attachments.length>0&&r){const t=document.createElement("div");t.className="attachments",e.attachments.forEach((e=>{const n=r.content.cloneNode(!0),c=n.querySelector(".filename"),o=n.querySelector(".icon");if(c&&o){const t=e.path.split(/[\/\\]/);c.textContent=t[t.length-1]||"",o.classList.add("file"===e.type?"codicon-file-code":"codicon-folder")}t.appendChild(n)})),a.appendChild(t)}c.appendChild(t),c.scrollTop=c.scrollHeight,c.querySelectorAll(".code-block .copy-button").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".code-block"),n=t?.querySelector("code")?.textContent;n&&navigator.clipboard.writeText(n).then((()=>{const t=e.target.closest(".copy-button");if(t){const e=t.innerHTML;t.innerHTML='<i class="codicon codicon-check"></i>',setTimeout((()=>{t.innerHTML=e}),1e3)}}))}))}))}(t.message);break;case"showLoading":!function(){if(!c)return;const e=document.createElement("div");e.className="message assistant loading",e.innerHTML='\n        <div class="avatar">\n            <i class="codicon codicon-loading codicon-modifier-spin"></i>\n        </div>\n        <div class="message-content">\n            <div class="markdown-content">Thinking...</div>\n        </div>\n    ',c.appendChild(e),c.scrollTop=c.scrollHeight}();break;case"hideLoading":!function(){if(!c)return;const e=c.querySelector(".loading");e&&e.remove()}();break;case"showError":t.error&&function(e){if(!c)return;const t=document.createElement("div");t.className="message system error",t.innerHTML=`\n        <div class="avatar">\n            <i class="codicon codicon-error"></i>\n        </div>\n        <div class="message-content">\n            <div class="markdown-content">Error: ${e}</div>\n        </div>\n    `,c.appendChild(t),c.scrollTop=c.scrollHeight}(t.error);break;case"fileAttached":t.path&&(E.push({type:"file",path:t.path}),f());break;case"folderAttached":t.path&&(E.push({type:"folder",path:t.path}),f());break;case"updateModels":t.models}}))})();