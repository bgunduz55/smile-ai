(()=>{"use strict";const e=acquireVsCodeApi(),t=document.getElementById("messageInput"),n=document.getElementById("sendButton"),o=document.getElementById("messages"),c=document.getElementById("addModel"),s=document.getElementById("includeImports"),a=document.getElementById("includeTips"),d=document.getElementById("includeTests"),i=document.getElementById("message-template"),l=document.getElementById("code-block-template"),r=document.getElementById("file-attachment-template"),m=document.getElementById("attachFile"),p=document.getElementById("attachFolder"),u=document.getElementById("chatMode"),g=document.getElementById("openChat"),h=document.getElementById("openComposer"),v=document.querySelectorAll(".toolbar-button[data-view]");t&&n&&o||console.error("Essential DOM elements not found"),t?.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())})),n?.addEventListener("click",f),c?.addEventListener("click",(()=>{e.postMessage({command:"addModel"})})),g?.addEventListener("click",(()=>{e.postMessage({command:"openChat"})})),h?.addEventListener("click",(()=>{e.postMessage({command:"openComposer"})})),v.forEach((t=>{t.addEventListener("click",(()=>{const n=t.dataset.view;n&&(v.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),e.postMessage({command:"switchView",view:n}))}))})),t?.addEventListener("input",(()=>{t.style.height="auto",t.style.height=`${t.scrollHeight}px`}));let E=[];function f(){const n=t?.value.trim();if(n){const o={includeImports:s?.checked??!0,includeTips:a?.checked??!0,includeTests:d?.checked??!0,chatMode:u?.value??"chat"};e.postMessage({command:"sendMessage",text:n,options:o,attachments:E}),t&&(t.value="",t.style.height="auto"),E=[],y()}}function y(){const e=document.querySelector(".current-attachments");e&&(e.innerHTML="",E.forEach((t=>{const n=document.createElement("div");n.className="attachment-item",n.innerHTML=`\n            <i class="codicon codicon-${"file"===t.type?"file-code":"folder"}"></i>\n            <span>${t.path.split("/").pop()||t.path.split("\\").pop()}</span>\n            <button class="remove-attachment" data-path="${t.path}">\n                <i class="codicon codicon-close"></i>\n            </button>\n        `;const o=n.querySelector(".remove-attachment");o?.addEventListener("click",(()=>{const e=o.dataset.path;e&&(E=E.filter((t=>t.path!==e)),y())})),e.appendChild(n)})))}m?.addEventListener("click",(()=>{e.postMessage({command:"attachFile"})})),p?.addEventListener("click",(()=>{e.postMessage({command:"attachFolder"})})),window.addEventListener("message",(e=>{const t=e.data;switch(console.log("Received message from extension:",t),t.command){case"addMessage":t.message&&(console.log("Adding message to UI:",t.message),function(e){if(!i||!o)return;const t=i.content.cloneNode(!0),n=t.querySelector(".message"),c=t.querySelector(".avatar i"),s=t.querySelector(".markdown-content");if(!n||!c||!s)return;n.classList.add(e.role),c.classList.add("user"===e.role?"codicon-account":"codicon-hubot");const a=function(e){return e.replace(/```(\w*)\n([\s\S]*?)```/g,((e,t,n)=>{if(!l)return`<pre><code>${n}</code></pre>`;const o=l.content.cloneNode(!0),c=o.querySelector("code");c&&(t&&c.classList.add(`language-${t}`),c.textContent=n.trim());const s=document.createElement("div");return s.appendChild(o),s.innerHTML})).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")}(e.content);if(s.innerHTML=a,e.attachments&&e.attachments.length>0&&r){const t=document.createElement("div");t.className="attachments",e.attachments.forEach((e=>{const n=r.content.cloneNode(!0),o=n.querySelector(".filename"),c=n.querySelector(".icon");if(o&&c){const t=e.path.split(/[\/\\]/);o.textContent=t[t.length-1]||"",c.classList.add("file"===e.type?"codicon-file-code":"codicon-folder")}t.appendChild(n)})),s.appendChild(t)}o.appendChild(t),o.scrollTop=o.scrollHeight,o.querySelectorAll(".code-block .copy-button").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".code-block"),n=t?.querySelector("code")?.textContent;n&&navigator.clipboard.writeText(n).then((()=>{const t=e.target.closest(".copy-button");if(t){const e=t.innerHTML;t.innerHTML='<i class="codicon codicon-check"></i>',setTimeout((()=>{t.innerHTML=e}),1e3)}}))}))}))}(t.message));break;case"showLoading":console.log("Showing loading state"),function(){if(!o)return;const e=document.createElement("div");e.className="message assistant loading",e.innerHTML='\n        <div class="avatar">\n            <i class="codicon codicon-loading codicon-modifier-spin"></i>\n        </div>\n        <div class="message-content">\n            <div class="markdown-content">Thinking...</div>\n        </div>\n    ',o.appendChild(e),o.scrollTop=o.scrollHeight}();break;case"hideLoading":console.log("Hiding loading state"),function(){if(!o)return;const e=o.querySelector(".loading");e&&e.remove()}();break;case"showError":t.error&&(console.log("Showing error:",t.error),function(e){if(!o)return;const t=document.createElement("div");t.className="message system error",t.innerHTML=`\n        <div class="avatar">\n            <i class="codicon codicon-error"></i>\n        </div>\n        <div class="message-content">\n            <div class="markdown-content">Error: ${e}</div>\n        </div>\n    `,o.appendChild(t),o.scrollTop=o.scrollHeight}(t.error));break;case"fileAttached":t.path&&(console.log("File attached:",t.path),E.push({type:"file",path:t.path}),y());break;case"folderAttached":t.path&&(console.log("Folder attached:",t.path),E.push({type:"folder",path:t.path}),y());break;case"updateModels":t.models&&console.log("Updating models list:",t.models)}}))})();